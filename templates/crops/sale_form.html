{% extends 'base.html' %}

{% block page_title %}Record Sale{% endblock %}

{% block content %}
<div class="card">
    <div class="card-title">Record Revenue</div>
    <p style="font-size: 13px; color: #666; margin-bottom: 20px;">Selling: {{ season.get_crop_type_display }}</p>
    
    <form method="POST">
        {% csrf_token %}
        
        <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" name="date" class="form-control" value="{% now 'Y-m-d' %}" required>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
                <label class="form-label">Quantity (kg)</label>
                <input type="number" step="0.01" name="quantity_kg" class="form-control" placeholder="0.00" required id="qty">
            </div>
            <div class="form-group">
                <label class="form-label">Price per kg ($)</label>
                <input type="number" step="0.01" name="price_per_kg" class="form-control" placeholder="0.00" required id="price">
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Expected Total</label>
            <div class="form-control" style="background: #f0f0f0; color: #2e7d32; font-weight: 700;" id="totalPreview">$0.00</div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Buyer Name</label>
            <input type="text" name="buyer" class="form-control" placeholder="Company or Individual">
        </div>
        
        <div class="form-group">
            <label class="form-label">Payment Status</label>
            <select name="payment_status" class="form-control">
                <option value="paid">Paid</option>
                <option value="pending">Pending</option>
                <option value="partial">Partial</option>
            </select>
        </div>
        
        <button type="submit" class="btn btn-success">Save Sale</button>
        <a href="{% url 'crops:season_detail' season.pk %}" class="btn btn-secondary">Cancel</a>
    </form>
</div>

{% block extra_js %}
<script>
    // Simple live calculation
    const qty = document.getElementById('qty');
    const price = document.getElementById('price');
    const total = document.getElementById('totalPreview');
    
    function calc() {
        const q = parseFloat(qty.value) || 0;
        const p = parseFloat(price.value) || 0;
        total.innerText = '$' + (q * p).toFixed(2);
    }
    
    qty.addEventListener('input', calc);
    price.addEventListener('input', calc);
</script>
{% endblock %}
{% endblock %}